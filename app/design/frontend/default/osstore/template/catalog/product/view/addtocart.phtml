<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category   design_default
 * @package    Mage
 * @copyright  Copyright (c) 2008 Irubin Consulting Inc. DBA Varien (http://www.varien.com)
 * @license    http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>

<?php $_product = $this->getProduct() ?>
<input id="isbuynow" type="hidden" value="0" name="isbuynow">
<?php if($_product->isSaleable()): ?>
    <fieldset class="add-to-cart-box">
        <legend><?php echo $this->__('Add Items to Cart') ?></legend>
        <?php if(!$_product->isGrouped()): ?>

        <span class="qty-box"><label for="qty"><?php echo $this->__('Qty') ?>:</label>
        <input name="qty" type="text" class="input-text qty" id="qty" maxlength="12" value="<?php if ($this->getMinimalQty($_product) == '') { echo '1'; } else {echo $this->getMinimalQty($_product); } ?>" /></span>
        <?php endif; ?>
		<?php //echo $this->getChildHtml('product_type_data') ?>
		<?php 
		function  getQuantityOrderedBySku($sku)
			{
			try {
			$_product = Mage::getResourceModel('reports/product_collection')
			->addOrderedQty()
			->addAttributeToFilter('sku', $sku)
			->setOrder('ordered_qty', 'desc')
			->getFirstItem();
			if (!$_product) {
			throw new Exception('No product matches the given SKU');
			}
			return (int)$_product->getOrderedQty();
			}
			catch (Exception $e) {
			return 0;
			}
			}
		?>
		<?php $_product = $this->getProduct() ?>

		<?php if($_product->isSaleable()): ?>
		    <p class="availability"><?php echo $this->__('Availability: In stock.') ?> [QTY:<?=Mage::getModel('cataloginventory/stock_item')->loadByProduct($_product)->getQty() *1?>] &nbsp; [Sold: <?php echo (int)getQuantityOrderedBySku($_product->getSku()) ?>]</p> 
		<?php else: ?>
		    <p class="availability"><?php echo $this->__('Availability: Out of stock.') ?></p>
		<?php endif; ?>
		
		<div style="margin-top:5px;">&nbsp&nbsp</div>
		<?php echo $this->getPriceHtml($_product) ?>
	<?php if(0) {?>
        <span class="form-button-dipp-blue"><a href="javascript:productAddToChoiceForm.submit();" ><?php echo $this->__('Buy it Now') ?></a></span>
	<?php }?>
        <?php if(1){?>
        <span class="form-button-dipp-blue"><a href="javascript:$('isbuynow').value = 1; productAddToCartForm.submit()"><?php echo $this->__('Buy it Now') ?></a></span>
        <span class="form-button-dipp-blue"><a href="javascript:productAddToCartForm.submit()"><?php echo $this->__('Add to Cart') ?></a></span>
        <?php }?>

    </fieldset>
<?php endif; ?>
